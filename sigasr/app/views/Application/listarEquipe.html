#{extends 'main.html' /} #{set title:'Equipes' /}
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
<script src="/siga/javascript/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/sigasr/public/javascripts/jquery.serializejson.min.js"></script>
<script src="/sigasr/public/javascripts/jquery.populate.js"></script>
<script src="/sigasr/public/javascripts/base-service.js"></script>

<script src="/sigasr/public/javascripts/detalhe-tabela.js"></script>
<script src="/sigasr/public/javascripts/jquery.maskedinput.min.js"></script>
<script src="/sigasr/public/javascripts/jquery.validate.min.js"></script>
<script src="/sigasr/public/javascripts/language/messages_pt_BR.min.js"></script>

<div class="gt-bd clearfix">
	<div class="gt-content">
		<h2>Pesquisa de Equipes</h2>
		<!-- content bomex -->
		<div class="gt-content-box gt-for-table dataTables_div">
			<table id="equipes_table" border="0" class="gt-table display">
				<thead>
					<tr>
						<th style="font-weight: bold;">Sigla</th>
						<th>Lotação</th>
					</tr>
				</thead>

				<tbody>
					#{list items:listaEquipe, as:'eq'}
					<tr style="cursor: pointer;"
						#{if eq.podeEditar(lotaTitular, cadastrante)}
						onclick="equipeService.editar($(this).data('json'), 'Alterar Equipe')"#{/if}
						data-json-id="${eq.idEquipe}" data-json="${eq.toJson()}">
						<td class="gt-celula-nowrap" style="font-size: 13px; font-weight: bold; border-bottom: 1px solid #ccc !important; padding: 7px 10px;">
							${eq.lotacao?.sigla}
						</td>
						<td class="gt-celula-nowrap" style="font-size: 13px; font-weight: bold; border-bottom: 1px solid #ccc !important; padding: 7px 10px;">
							${eq.lotacao?.descricao}
						</td>
					</tr>
					#{/list}
				</tbody>
			</table>
		</div>
		<div class="gt-table-buttons">
			<a onclick="equipeService.cadastrar('Incluir Equipe')" class="gt-btn-medium gt-btn-left">Incluir</a>
		</div>
	</div>
</div>


#{modal nome:'equipe', titulo:'Cadastrar Equipe'}
	<div id="divEditarForm">#{include
				'Application/editarEquipe.html' /}</div>
#{/modal}

<script type="text/javascript">
	var opts = {
			 urlGravar : '@{Application.gravarEquipe()}',
			 dialogCadastro : $('#equipe_dialog'),
			 tabelaRegistros : $('#equipes_table'),
			 objectName : 'equipe',
			 formCadastro : $('#form')
	};

	$(document).ready(function() {
		/* Table initialization */
		opts.dataTable = $('#equipes_table').dataTable({
			"language": {
				"emptyTable":     "Não existem resultados",
			    "info":           "Mostrando de _START_ a _END_ do total de _TOTAL_ registros",
			    "infoEmpty":      "Mostrando de 0 a 0 do total de 0 registros",
			    "infoFiltered":   "(filtrando do total de _MAX_ registros)",
			    "infoPostFix":    "",
			    "thousands":      ".",
			    "lengthMenu":     "Mostrar _MENU_ registros",
			    "loadingRecords": "Carregando...",
			    "processing":     "Processando...",
			    "search":         "Filtrar:",
			    "zeroRecords":    "Nenhum registro encontrado",
			    "paginate": {
			        "first":      "Primeiro",
			        "last":       "Último",
			        "next":       "Próximo",
			        "previous":   "Anterior"
			    },
			    "aria": {
			        "sortAscending":  ": clique para ordenação crescente",
			        "sortDescending": ": clique para ordenação decrescente"
			    }
			},
			"iDisplayLength": 25
		});
	});

	// Define a "classe" EquipeService
	function EquipeService(opts) {
		// super(opts)
		BaseService.call(this, opts);
	}
	// EquipeService extends BaseService
	EquipeService.prototype = Object.create(BaseService.prototype);
	
	var equipeService = new EquipeService(opts);
	equipeService.getId = function(equipe) {
		return equipe.idEquipe;
	}
	equipeService.getRow = function(equipe) {
		return [equipe.lotacao.sigla, equipe.lotacao.descricao];
	}
	equipeService.onRowClick = function(equipe) {
		equipeService.editar(equipe, 'Alterar Equipe');
	}

	function inserirEditarEquipe() {
		limparDadosEquipeModal();
		equipeModalAbrir(false);
	}
	
	function equipeModalAbrir(isEdicao) {
		isEditing = isEdicao;
		
		if (isEdicao)
			$("#editarEquipe_dialog").dialog('option', 'title', 'Alterar Equipe');
		else
			$("#editarEquipe_dialog").dialog('option', 'title', 'Incluir Equipe');

		$("#editarEquipe_dialog").dialog('open');
	}

	function equipeModalFechar() {
		$("#editarEquipe_dialog").dialog('close');
		limparDadosEquipeModal();
	}

	function limparDadosEquipeModal() {
// 		$("#idEquipe").val('');
// 		$("#idEquipeIni").val('');
		$("#lotacao").val('');

// 		removerItensLista('gestoresUl');
// 		removerItensLista('fatoresUl');

// 		resetAllErrorMessage();
	}
	
</script>