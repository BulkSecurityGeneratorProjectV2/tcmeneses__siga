#{extends 'main.html' /}

<div class="gt-bd clearfix">
	<div class="gt-content clearfix">

		<h2>Solicitação ${solicitacao.codigo}</h2>
		#{quadroSolicitacao solicitacao:solicitacao, ocultarCodigo:true /}
		<br/>
		<p class="gt-table-action-list">
				#{if criarFilha}<a class="once" href="@{Application.criarFilha(solicitacao.idSolicitacao)}">
				<img src="http://localhost:8080/siga/css/famfamfam/icons/arrow_divide.png" style="margin-right:5px;">
				Criar solicitação filha
				</a>
				&nbsp;&nbsp;&nbsp;#{/if}
				#{if editar}
				<a class="once" href="@{Application.editar(solicitacao.idSolicitacao)}">
					<img src="http://localhost:8080/siga/css/famfamfam/icons/pencil.png" style="margin-right:5px;">
					Editar solicitação
				</a>
				&nbsp;&nbsp;&nbsp;
				#{/if}
			</p>
		<div class="gt-content-box gt-form" style="margin-top: 15px;">
			#{form @Application.andamento(), enctype:'multipart/form-data'} <input
				type="hidden" name="andamento.solicitacao.idSolicitacao"
				value="${solicitacao.idSolicitacao}"> 
				
			#{if trocarSituacao}
			<div class="gt-form-row gt-width-66">
				<label>Situação</label> #{select 'andamento.estado', items:estados,
				labelProperty:'descrEstado', value:andamento.estado,
				valueProperty:idEstado} #{/select} </div> #{/if}
					
			#{if trocarAtendente}
			<div class="gt-form-row gt-width-66">
				<label>Atendente</label> #{pessoaLotaSelecao
				nomeSelPessoa:'andamento.atendente',
				nomeSelLotacao:'andamento.lotaAtendente',
				valuePessoa:andamento.atendente,
				valueLotacao:andamento.lotaAtendente /}
			</div>
			#{/if}
			
			<div class="gt-form-row gt-width-66">
				<label>Descrição</label>
				<textarea name="andamento.descrAndamento" id="descrSolicitacao"
					cols="70" rows="4" value="${andamento.descrAndamento}"></textarea>
			</div>
			<div class="gt-form-row gt-width-66">
				<label>Anexar arquivo</label> <input type="file"
					name="andamento.arquivo">
			</div>

				<div class="gt-form-row">
					<input type="submit" value="Gravar"
						class="gt-btn-medium gt-btn-left" />
				</div>
				#{/form}
			</div>

			<!-- content box -->
			<div class="gt-content-box" style="margin-top: 15px;">
				<table border="0" class="gt-table">
					<thead>
						<tr>
							<th>Momento</th>
							<th>Situação</th>
							<th colspan="2">Atendente</th>
							<th colspan="2">Cadastrante</th>
							<th>Anexo</th>
							<th>Descrição</th>
							<th></th>
						</tr>
					</thead>

					<tbody>
						#{list items:solicitacao.andamentoSet, as:'andamento'}
						<tr>
							<td>${andamento.dtRegString}</td>
							<td>${andamento.estado.descrEstado}</td>
							<td>#{selecionado
								sigla:andamento.lotaAtendente?.siglaLotacao,
								descricao:andamento.lotaAtendente?.nomeLotacao /}</td>
							<td>#{selecionado sigla:andamento.atendente?.nomeAbreviado,
								descricao:andamento.atendente?.descricaoIniciaisMaiusculas /}</td>
							<td>#{selecionado
								sigla:andamento.lotaCadastrante?.siglaLotacao,
								descricao:andamento.lotaCadastrante?.nomeLotacao /}</td>
							<td>#{selecionado
								sigla:andamento.cadastrante?.nomeAbreviado,
								descricao:andamento.cadastrante?.descricaoIniciaisMaiusculas /}</td>
							<td>#{arquivo arquivo:andamento.arquivo /}</td>
							<td>${andamento.descrAndamento}</td>
							<td>#{if andamento_isFirst && desfazerAndamento}
								<a class="once" href="@{Application.desfazerUltimoAndamento(solicitacao.idSolicitacao)}">
									<img src="http://localhost:8080/siga/css/famfamfam/icons/cancel.png" style="margin-right:5px;">
								</a>#{/if}</td>
						</tr>
						#{/list}
					</tbody>
				</table>
			</div>
			<!-- /content box -->

		</div>
	</div>

	<br /> <br /> <br />