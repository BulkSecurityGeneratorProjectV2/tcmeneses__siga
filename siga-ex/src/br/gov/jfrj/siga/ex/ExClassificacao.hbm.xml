<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >

<!-- Created Mon Nov 14 13:36:50 GMT-03:00 2005                         -->
<hibernate-mapping package="br.gov.jfrj.siga.ex">

	<class name="ExClassificacao" schema="SIGA" table="EX_CLASSIFICACAO" batch-size="20">
		<id name="idClassificacao" column="ID_CLASSIFICACAO"
			type="long">
			<generator class="sequence">
				<param name="sequence">EX_CLASSIFICACAO_SEQ</param>
			</generator>
		</id>

		<property name="codAssunto" column="COD_ASSUNTO" type="byte"
			not-null="false" />
		<property name="codAssuntoPrincipal"
			column="COD_ASSUNTO_PRINCIPAL" type="byte" not-null="false" />
		<property name="codAssuntoSecundario"
			column="COD_ASSUNTO_SECUNDARIO" type="byte" not-null="false" />
		<property name="codClasse" column="COD_CLASSE" type="byte"
			not-null="true" />
		<property name="codSubclasse" column="COD_SUBCLASSE"
			type="short" not-null="true" />
		<property name="codAtividade" column="COD_ATIVIDADE"
			type="short" not-null="true" />
		<property name="descrClassificacao" column="DESCR_CLASSIFICACAO"
			type="string" not-null="true" />
		<property name="facilitadorClass" column="FACILITADOR_CLASS"
			type="string" />
		<property name="descrClassificacaoAI"
			formula="REMOVE_ACENTO(DESCR_CLASSIFICACAO)" type="string" />

		<property name="dtFimReg" column="DT_FIM_REG" type="date" />
		<property name="dtIniReg" column="DT_INI_REG" type="date" />
		<property name="idRegIni" column="ID_REG_INI" type="long" />

		<property lazy="true" name="descrAssuntoPrincipalAI"
			formula="REMOVE_ACENTO((SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO_PRINCIPAL=COD_ASSUNTO_PRINCIPAL 
														AND CLA.COD_ASSUNTO_SECUNDARIO=0 
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL))"
			type="string" />
		<property lazy="true" name="descrAssuntoSecundarioAI"
			formula="REMOVE_ACENTO((SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO_PRINCIPAL=COD_ASSUNTO_PRINCIPAL 
														AND CLA.COD_ASSUNTO_SECUNDARIO=COD_ASSUNTO_SECUNDARIO 
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL))"
			type="string" />


		<property lazy="true" name="descrAssuntoAI"
			formula="REMOVE_ACENTO((SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL))"
			type="string" />
		<property lazy="true" name="descrClasseAI"
			formula="REMOVE_ACENTO((SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=COD_CLASSE 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL))"
			type="string" />
		<property lazy="true" name="descrSubclasseAI"
			formula="REMOVE_ACENTO((SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=COD_CLASSE 
														AND CLA.COD_SUBCLASSE=COD_SUBCLASSE 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL))"
			type="string" />

		<property lazy="true" name="descrAssuntoPrincipal"
			formula="(SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO_PRINCIPAL=COD_ASSUNTO_PRINCIPAL 
														AND CLA.COD_ASSUNTO_SECUNDARIO=0 
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL)"
			type="string" />
		<property lazy="true" name="descrAssuntoSecundario"
			formula="(SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO_PRINCIPAL=COD_ASSUNTO_PRINCIPAL 
														AND CLA.COD_ASSUNTO_SECUNDARIO=COD_ASSUNTO_SECUNDARIO 
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL)"
			type="string" />
		<property lazy="true" name="descrAssunto"
			formula="(SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=0 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL)"
			type="string" />
		<property lazy="true" name="descrClasse"
			formula="(SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=COD_CLASSE 
														AND CLA.COD_SUBCLASSE=0 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL)"
			type="string" />
		<property lazy="true" name="descrSubclasse"
			formula="(SELECT CLA.DESCR_CLASSIFICACAO FROM SIGA.EX_CLASSIFICACAO CLA  
														WHERE CLA.COD_ASSUNTO=COD_ASSUNTO
														AND CLA.COD_CLASSE=COD_CLASSE 
														AND CLA.COD_SUBCLASSE=COD_SUBCLASSE 
														AND CLA.COD_ATIVIDADE=0
														AND CLA.DT_FIM_REG IS NULL)"
			type="string" />


		<set name="exViaSet" inverse="true"
			where="(ID_CLASSIFICACAO &lt;&gt; 1328 or COD_VIA &lt;&gt; 1) and DT_FIM_REG is null"
			order-by="COD_VIA asc">

			<key column="ID_CLASSIFICACAO" />
			<one-to-many class="ExVia" />
		</set>

		<set name="exModeloSet" inverse="true">
			<key column="ID_MOD" />
			<one-to-many class="ExModelo" />
		</set>

	</class>
	
	<query name="consultarAssuntosExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codClasse = 0 
	       	and cl.codSubclasse = 0 
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null 
	       	order by cl.descrClassificacao]]>
	</query>
	
	<query name="consultarAssuntosPrincipalExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssuntoSecundario = 0 
	       	and cl.codClasse = 0 
	       	and cl.codSubclasse = 0 
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null 
	       	order by cl.descrClassificacao]]>
	</query>

	<query name="consultarAssuntosSecundarioExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssuntoPrincipal = :assuntoPrincipal 
	       	and cl.codClasse = 0 
	       	and cl.codSubclasse = 0  
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null 
	       	order by cl.descrClassificacao]]>
	</query>

	<query name="consultarClassesAntigoExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssuntoPrincipal =  :assuntoPrincipal   
	       	and cl.codAssuntoSecundario =  :assuntoSecundario  
	       	and cl.codSubclasse = 0  
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null 
	       	order by cl.descrClassificacao]]>
	</query>
	
	<query name="consultarClassesExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssunto =  :assunto
	       	and cl.codSubclasse = 0  
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null 
	       	order by cl.descrClassificacao]]>
	</query>

	<query name="consultarSubClassesAntigoExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssuntoPrincipal =  :assuntoPrincipal   
	       	and cl.codAssuntoSecundario =  :assuntoSecundario  
	       	and cl.codClasse =  :classe  
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null
	       	order by cl.descrClassificacao]]>
	</query>
	
	<query name="consultarSubClassesExClassificacao">
		<![CDATA[from ExClassificacao cl 
	      where cl.codAssunto =  :assunto  
	       	and cl.codClasse =  :classe  
	       	and cl.codAtividade = 0
	       	and cl.dtFimReg is null
	       	order by cl.descrClassificacao]]>
	</query>

	<query name="consultarAtividadesExClassificacao">
		<![CDATA[select distinct(cl) from ExClassificacao cl,ExVia v 
	      where cl.codAssuntoPrincipal =  :assuntoPrincipal   
	       	and cl.codAssuntoSecundario =  :assuntoSecundario  
	       	and cl.codClasse =  :classe  
	       	and cl.codSubclasse =  :subclasse  
	       	and cl.idClassificacao = v.exClassificacao.idClassificacao 
	       	and (v.codVia is not null or :ultimoNivel=true)
	       	and v.dtFimReg is null
	       	and cl.dtFimReg is null
	       	order by cl.descrClassificacao]]>
	</query>

	<query name="consultarPorFiltroExClassificacao">
		<![CDATA[select distinct(cla) from ExClassificacao cla ,ExVia v 
		where 	(
		        (upper(cla.descrAssuntoPrincipalAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrAssuntoSecundarioAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrClassificacaoAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrClasseAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrSubclasseAI) like upper('%' || :descrClassificacao || '%'))  
				)
	    	and (cla.codAssuntoPrincipal = :codAssuntoPrincipal or :codAssuntoPrincipal=-1)
	    	and (cla.codAssuntoSecundario = :codAssuntoSecundario or :codAssuntoSecundario=-1 )
	    	and (cla.codAssunto = :codAssunto or :codAssunto=-1 )
	    	and (cla.codClasse = :codClasse or :codClasse=-1)
	    	and cla.dtFimReg is null
	    	and (cla.codSubclasse = :codSubclasse or :codSubclasse=-1)
	    	and (cla.codAtividade = :codAtividade or :codAtividade=-1)
	       	and cla.idClassificacao = v.exClassificacao.idClassificacao 
	       	and (v.codVia is not null or :ultimoNivel=true)
	       	and v.dtFimReg is null
	    	order by cla.codAssunto,cla.codClasse,
	    		cla.codSubclasse,cla.codAtividade]]>
	</query>

	<query name="consultarQuantidadeExClassificacao">
		<![CDATA[select count(distinct cla) from ExClassificacao cla ,ExVia v  
		where 	(
		        (upper(cla.descrAssuntoPrincipalAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrAssuntoSecundarioAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrClassificacaoAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrClasseAI) like upper('%' || :descrClassificacao || '%')) or
				(upper(cla.descrSubclasseAI) like upper('%' || :descrClassificacao || '%'))  
				)
    	and (cla.codAssuntoPrincipal = :codAssuntoPrincipal or :codAssuntoPrincipal=-1)
    	and (cla.codAssuntoSecundario = :codAssuntoSecundario or :codAssuntoSecundario=-1 )
    	and (cla.codAssunto = :codAssunto or :codAssunto=-1 )
    	and (cla.codClasse = :codClasse or :codClasse=-1)
    	and (cla.codSubclasse = :codSubclasse or :codSubclasse=-1)
    	and (cla.codAtividade = :codAtividade or :codAtividade=-1)
    	and cla.idClassificacao = v.exClassificacao.idClassificacao
    	and v.dtFimReg is null 
    	and cla.dtFimReg is null
	    and (v.codVia is not null or :ultimoNivel=true))]]>
	</query>

	<query name="consultarPorSiglaExClassificacao">
		<![CDATA[select cla from ExClassificacao cla 
 		where  (cla.codAssuntoPrincipal = :codAssuntoPrincipal or :codAssuntoPrincipal = -1 or :codAssuntoPrincipal = null)
    	and (cla.codAssuntoSecundario = :codAssuntoSecundario or :codAssuntoSecundario = -1 or :codAssuntoSecundario = null)
    	and (cla.codAssunto = :codAssunto or :codAssunto = -1 or :codAssunto = null)
    	and cla.codClasse = :codClasse
    	and cla.codSubclasse = :codSubclasse
    	and cla.codAtividade = :codAtividade
    	and cla.dtFimReg is null]]>
	</query>

	<query name="consultarAtualPorId">
		<![CDATA[select cla from ExClassificacao cla 
 		where  cla.idRegIni = :idRegIni
    	and cla.dtFimReg is null]]>
	</query>

</hibernate-mapping>
